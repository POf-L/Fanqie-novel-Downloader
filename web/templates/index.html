<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>番茄小说下载器</title>
    <link rel="stylesheet" href="/static/css/style.css?v=20260130">
    <link rel="stylesheet" href="/static/css/style_forms.css?v=20260130">
    <link rel="stylesheet" href="/static/css/style_queue.css?v=20260130">
    <link rel="stylesheet" href="/static/css/style_misc.css?v=20260130">
    <link rel="stylesheet" href="/static/css/modal.css?v=20260130">
    <link rel="stylesheet" href="/static/css/modal_extra.css?v=20260130">
    <link rel="stylesheet" href="/static/css/responsive.css?v=20260130">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js" defer></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- 顶部栏 -->
        <header class="dashboard-header">
            <div class="brand">
                <img src="https://th.bing.com/th/id/ODF.ImujSAzXjUkVqHU809ZzQQ?w=32&h=32&qlt=90&pcl=fffffc&o=6&cb=ucfimg1&pid=1.2&ucfimg=1" class="app-logo-icon" alt="">
                <h1 class="app-title">番茄小说下载器</h1>
            </div>
            <div class="header-actions">
                <a href="https://github.com/POf-L/Fanqie-novel-Downloader" target="_blank" class="btn btn-sm btn-secondary icon-btn" title="GitHub">
                    <iconify-icon icon="line-md:github-loop"></iconify-icon>
                </a>
                <span class="version-tag">v<span id="version">{{ version }}</span></span>
                <div class="window-controls">
                    <button class="win-btn win-minimize" id="winMinimize"></button>
                    <button class="win-btn win-maximize" id="winMaximize"></button>
                    <button class="win-btn win-close" id="winClose"></button>
                </div>
            </div>
        </header>

        <div class="dashboard-grid dashboard-grid-full">
            <!-- 左侧主内容区 -->
            <main class="dashboard-main">
                <div class="card content-card">
                    <!-- 导航标签 -->
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="search" title="搜索">
                            <iconify-icon icon="line-md:search"></iconify-icon>
                            <span class="tab-label">搜索</span>
                        </button>
                        <button class="tab-btn" data-tab="queue" title="队列">
                            <iconify-icon icon="line-md:list-3"></iconify-icon>
                            <span class="tab-label">队列</span>
                        </button>
                        <button class="tab-btn" data-tab="settings" title="设置">
                            <iconify-icon icon="line-md:cog-loop"></iconify-icon>
                            <span class="tab-label">设置</span>
                        </button>
                    </div>

                    <!-- 内容区域 -->
                    <div class="tab-content">
                        <!-- 搜索面板 -->
                        <div class="tab-pane active" id="tab-search">
                            <div class="search-bar-container">
                                <div class="input-group">
                                    <input type="text" id="searchKeyword" class="form-input" placeholder="搜索书名、作者，或输入书籍ID/链接">
                                    <select id="statusFilter" class="form-select" style="width: auto;">
                                        <option value="">全部</option>
                                        <option value="连载中">连载中</option>
                                        <option value="已完结">已完结</option>
                                    </select>
                                    <button class="btn btn-primary icon-btn" id="searchBtn" title="搜索">
                                        <iconify-icon icon="line-md:search"></iconify-icon>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="searchResults" class="search-results-area">
                                <div class="search-header" id="searchHeader" style="display: none;">
                                    <span class="search-count" id="searchResultCount">0</span>
                                    <button class="btn btn-sm btn-text icon-btn" id="clearSearchBtn" title="清除">
                                        <iconify-icon icon="line-md:close"></iconify-icon>
                                    </button>
                                </div>
                                <div id="searchResultList" class="search-grid">
                                    <div id="loadMoreContainer" class="load-more-container" style="display: none;">
                                        <button class="btn btn-sm btn-secondary" id="loadMoreBtn">
                                            <iconify-icon icon="line-md:arrow-down"></iconify-icon>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 队列面板（合并任务中心） -->
                        <div class="tab-pane" id="tab-queue">
                            <div class="queue-container">
                                <!-- 下载设置 -->
                                <div class="queue-toolbar">
                                    <div class="queue-path-group">
                                        <input type="text" id="savePath" class="form-input path-input" readonly title="保存路径">
                                        <button class="btn btn-secondary icon-btn" id="browseBtn" title="浏览">
                                            <iconify-icon icon="line-md:folder-plus-twotone"></iconify-icon>
                                        </button>
                                    </div>
                                    <div class="format-selector">
                                        <label class="format-option-card">
                                            <input type="radio" name="format" value="txt" id="formatTxt" checked>
                                            <span class="format-name">TXT</span>
                                        </label>
                                        <label class="format-option-card">
                                            <input type="radio" name="format" value="epub" id="formatEpub">
                                            <span class="format-name">EPUB</span>
                                        </label>
                                    </div>
                                    <div class="queue-header">
                                        <div class="queue-summary" id="queueSummary">0</div>
                                        <div class="queue-actions">
                                            <button class="btn btn-secondary icon-btn" id="loadFromFileBtn" title="从文件加载书籍列表">
                                                <iconify-icon icon="line-md:document-add"></iconify-icon>
                                            </button>
                                            <input type="file" id="bookListFileInput" accept=".txt" style="display: none;">
                                            <button class="btn btn-primary" id="startQueueBtn" title="开始下载">
                                                <iconify-icon icon="line-md:play"></iconify-icon>
                                            </button>
                                            <button class="btn btn-secondary" id="clearQueueBtn" title="清空">
                                                <iconify-icon icon="line-md:remove"></iconify-icon>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 队列控制按钮 -->
                                <div class="queue-controls" id="queueControls" style="display: none;">
                                    <button class="btn btn-sm btn-warning" id="skipCurrentBtn" title="跳过当前任务">
                                        <iconify-icon icon="line-md:arrow-right"></iconify-icon>
                                        <span>跳过当前</span>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" id="forceSaveBtn" title="强制保存已下载内容">
                                        <iconify-icon icon="line-md:download-outline"></iconify-icon>
                                        <span>强制保存</span>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" id="retryAllBtn" title="重试所有失败任务" style="display: none;">
                                        <iconify-icon icon="line-md:backup-restore"></iconify-icon>
                                        <span>重试全部</span>
                                    </button>
                                </div>

                                <div class="queue-list" id="queueList">
                                    <div class="empty-state">
                                        <iconify-icon icon="line-md:coffee-half-empty-twotone-loop" class="empty-icon"></iconify-icon>
                                        <div class="empty-state-text">空</div>
                                    </div>
                                </div>

                                <!-- 任务中心（嵌入在队列下方） -->
                                <div class="tasks-section" id="tasksSection">
                                    <div class="tasks-header">
                                        <h3>
                                            <iconify-icon icon="line-md:downloading-loop"></iconify-icon>
                                            <span>任务中心</span>
                                        </h3>
                                    </div>
                                    <div class="tasks-grid">
                                        <!-- 当前任务状态 -->
                                        <div class="task-status-card">
                                            <div class="task-status-header">
                                                <h3>
                                                    <iconify-icon icon="line-md:downloading-loop"></iconify-icon>
                                                    <span>当前任务</span>
                                                </h3>
                                                <span class="status-badge" id="statusTextMain">
                                                    <iconify-icon icon="line-md:confirm-circle"></iconify-icon>
                                                </span>
                                            </div>
                                            <div class="task-status-body">
                                                <div class="task-stats-row">
                                                    <div class="task-stat-item">
                                                        <iconify-icon icon="line-md:book-2"></iconify-icon>
                                                        <div class="task-stat-info">
                                                            <span class="task-stat-label">书名</span>
                                                            <span class="task-stat-value" id="bookNameMain">-</span>
                                                        </div>
                                                    </div>
                                                    <div class="task-stat-item">
                                                        <iconify-icon icon="line-md:speedometer"></iconify-icon>
                                                        <div class="task-stat-info">
                                                            <span class="task-stat-label">速度</span>
                                                            <span class="task-stat-value" id="downloadSpeed">0 KB/s</span>
                                                        </div>
                                                    </div>
                                                    <div class="task-stat-item">
                                                        <iconify-icon icon="line-md:clock"></iconify-icon>
                                                        <div class="task-stat-info">
                                                            <span class="task-stat-label">耗时</span>
                                                            <span class="task-stat-value" id="elapsedTime">0s</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="progress-section">
                                                    <div class="progress-info">
                                                        <span class="progress-label">下载进度</span>
                                                        <span class="progress-percent" id="progressPercentMain">0%</span>
                                                    </div>
                                                    <div class="progress-track">
                                                        <div class="progress-bar" id="progressFillMain" style="width: 0%;"></div>
                                                    </div>
                                                </div>
                                                <div class="progress-details">
                                                    <span id="progressDetailInfo">0 / 0 章节</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 统计概览 -->
                                        <div class="task-summary-card">
                                            <div class="task-summary-header">
                                                <h3>
                                                    <iconify-icon icon="line-md:chart-bar"></iconify-icon>
                                                    <span>统计</span>
                                                </h3>
                                            </div>
                                            <div class="task-summary-grid">
                                                <div class="summary-stat">
                                                    <div class="summary-stat-icon pending">
                                                        <iconify-icon icon="line-md:list-3"></iconify-icon>
                                                    </div>
                                                    <div class="summary-stat-info">
                                                        <span class="summary-stat-value" id="statPending">0</span>
                                                        <span class="summary-stat-label">待下载</span>
                                                    </div>
                                                </div>
                                                <div class="summary-stat">
                                                    <div class="summary-stat-icon downloading">
                                                        <iconify-icon icon="line-md:loading-twotone-loop" class="spin"></iconify-icon>
                                                    </div>
                                                    <div class="summary-stat-info">
                                                        <span class="summary-stat-value" id="statDownloading">0</span>
                                                        <span class="summary-stat-label">下载中</span>
                                                    </div>
                                                </div>
                                                <div class="summary-stat">
                                                    <div class="summary-stat-icon completed">
                                                        <iconify-icon icon="line-md:confirm-circle"></iconify-icon>
                                                    </div>
                                                    <div class="summary-stat-info">
                                                        <span class="summary-stat-value" id="statCompleted">0</span>
                                                        <span class="summary-stat-label">已完成</span>
                                                    </div>
                                                </div>
                                                <div class="summary-stat">
                                                    <div class="summary-stat-icon failed">
                                                        <iconify-icon icon="icon-park-outline:error"></iconify-icon>
                                                    </div>
                                                    <div class="summary-stat-info">
                                                        <span class="summary-stat-value" id="statFailed">0</span>
                                                        <span class="summary-stat-label">失败</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 日志区域 -->
                                        <div class="task-log-card">
                                            <div class="task-log-header">
                                                <h3>
                                                    <iconify-icon icon="line-md:text-box"></iconify-icon>
                                                    <span>日志</span>
                                                </h3>
                                                <div class="log-actions">
                                                    <button class="btn btn-sm btn-text icon-btn" id="copyLogBtn" title="复制日志">
                                                        <iconify-icon icon="line-md:copy"></iconify-icon>
                                                    </button>
                                                    <button class="btn btn-sm btn-text icon-btn" id="clearLogBtn" title="清空日志">
                                                        <iconify-icon icon="line-md:remove"></iconify-icon>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="log-container" id="logContainerMain">
                                                <div id="logContentMain">
                                                    <div class="log-entry">等待任务开始...</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 设置面板 -->
                        <div class="tab-pane scrollable" id="tab-settings">
                            <div class="settings-container">
                                <!-- API节点设置 -->
                                <div class="settings-section">
                                    <h3 class="settings-section-title">
                                        <iconify-icon icon="line-md:cloud-alt-download-twotone-loop"></iconify-icon>
                                        <span>下载节点</span>
                                    </h3>
                                    <div class="setting-item setting-item-select">
                                        <div class="setting-header">
                                            <label class="setting-label">API节点</label>
                                            <span class="setting-status" id="apiNodeStatus">
                                                <iconify-icon icon="line-md:loading-twotone-loop" class="spin"></iconify-icon>
                                            </span>
                                        </div>
                                        <div class="setting-control">
                                            <select id="apiSourceSelect" class="form-input">
                                                <option value="">加载中...</option>
                                            </select>
                                            <button class="btn btn-secondary icon-btn" id="refreshApiNodesBtn" title="刷新节点">
                                                <iconify-icon icon="line-md:backup-restore"></iconify-icon>
                                            </button>
                                        </div>
                                        <span class="setting-hint">选择距离你最近的节点以获得最佳下载速度</span>
                                    </div>
                                </div>

                                <!-- 并发设置 -->
                                <div class="settings-section">
                                    <h3 class="settings-section-title">
                                        <iconify-icon icon="line-md:download-loop"></iconify-icon>
                                        <span>并发设置</span>
                                    </h3>
                                    <div class="settings-grid">
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">最大并发数</label>
                                                <span class="setting-value" id="setting_max_workers_value">30</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_max_workers_range" class="setting-slider" min="1" max="100" value="30">
                                                <input type="number" id="setting_max_workers" class="form-input setting-number" min="1" max="100" value="30">
                                            </div>
                                            <span class="setting-hint">同时下载的最大线程数</span>
                                        </div>
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">请求间隔(秒)</label>
                                                <span class="setting-value" id="setting_request_rate_limit_value">0.02</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_request_rate_limit_range" class="setting-slider" min="0" max="1000" value="20">
                                                <input type="number" id="setting_request_rate_limit" class="form-input setting-number" min="0" max="10" step="0.01" value="0.02">
                                            </div>
                                            <span class="setting-hint">每个请求之间的延迟</span>
                                        </div>
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">连接池大小</label>
                                                <span class="setting-value" id="setting_connection_pool_size_value">200</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_connection_pool_size_range" class="setting-slider" min="10" max="500" value="200">
                                                <input type="number" id="setting_connection_pool_size" class="form-input setting-number" min="10" max="500" value="200">
                                            </div>
                                            <span class="setting-hint">HTTP连接池的大小</span>
                                        </div>
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">异步批次大小</label>
                                                <span class="setting-value" id="setting_async_batch_size_value">50</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_async_batch_size_range" class="setting-slider" min="1" max="200" value="50">
                                                <input type="number" id="setting_async_batch_size" class="form-input setting-number" min="1" max="200" value="50">
                                            </div>
                                            <span class="setting-hint">每批次处理的请求数量</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 网络设置 -->
                                <div class="settings-section">
                                    <h3 class="settings-section-title">
                                        <iconify-icon icon="line-md:backup-restore"></iconify-icon>
                                        <span>网络设置</span>
                                    </h3>
                                    <div class="settings-grid">
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">最大重试次数</label>
                                                <span class="setting-value" id="setting_max_retries_value">3</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_max_retries_range" class="setting-slider" min="0" max="10" value="3">
                                                <input type="number" id="setting_max_retries" class="form-input setting-number" min="0" max="10" value="3">
                                            </div>
                                            <span class="setting-hint">失败后的最大重试次数</span>
                                        </div>
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">超时时间(秒)</label>
                                                <span class="setting-value" id="setting_request_timeout_value">30</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_request_timeout_range" class="setting-slider" min="5" max="300" value="30">
                                                <input type="number" id="setting_request_timeout" class="form-input setting-number" min="5" max="300" value="30">
                                            </div>
                                            <span class="setting-hint">单个请求的超时时间</span>
                                        </div>
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">API请求限制</label>
                                                <span class="setting-value" id="setting_api_rate_limit_value">50</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_api_rate_limit_range" class="setting-slider" min="1" max="200" value="50">
                                                <input type="number" id="setting_api_rate_limit" class="form-input setting-number" min="1" max="200" value="50">
                                            </div>
                                            <span class="setting-hint">每个时间窗口的最大请求数</span>
                                        </div>
                                        <div class="setting-item setting-item-slider">
                                            <div class="setting-header">
                                                <label class="setting-label">限流窗口(秒)</label>
                                                <span class="setting-value" id="setting_rate_limit_window_value">1.0</span>
                                            </div>
                                            <div class="setting-control">
                                                <input type="range" id="setting_rate_limit_window_range" class="setting-slider" min="1" max="100" value="10">
                                                <input type="number" id="setting_rate_limit_window" class="form-input setting-number" min="0.1" max="10" step="0.1" value="1.0">
                                            </div>
                                            <span class="setting-hint">限流计算的时间窗口</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 操作按钮 -->
                                <div class="settings-actions">
                                    <button class="btn btn-primary" id="saveSettingsBtn">
                                        <iconify-icon icon="line-md:confirm"></iconify-icon>
                                        <span>保存设置</span>
                                    </button>
                                    <button class="btn btn-secondary" id="resetSettingsBtn">
                                        <iconify-icon icon="line-md:close"></iconify-icon>
                                        <span>恢复默认</span>
                                    </button>
                                </div>

                                <!-- 设置提示 -->
                                <div class="settings-message" id="settingsMessage" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            </div>
    </div>

    <!-- 加载状态遮罩层 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner">
                <iconify-icon icon="line-md:loading-twotone-loop" class="spin"></iconify-icon>
            </div>
            <div class="loading-text" id="loadingText">正在启动服务器...</div>
            <div class="loading-hint" id="loadingHint">请稍候，首次启动可能需要几秒钟</div>
        </div>
    </div>

    <!-- 隐藏元素 -->
    <div id="tab-progress" style="display: none;"></div>
    <span id="progressBadge" style="display: none;"></span>

    <!-- 章节选择弹窗 -->
    <div class="modal" id="chapterModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <iconify-icon icon="line-md:list-3"></iconify-icon>
                    <span>章节</span>
                </h3>
                <button class="modal-close" id="chapterModalClose">
                    <iconify-icon icon="line-md:close"></iconify-icon>
                </button>
            </div>
            <div class="modal-body">
                <div class="chapter-actions">
                    <button class="btn btn-sm btn-secondary" id="selectAllBtn" title="全选">
                        <iconify-icon icon="line-md:confirm-circle"></iconify-icon>
                    </button>
                    <button class="btn btn-sm btn-secondary" id="selectNoneBtn" title="全不选">
                        <iconify-icon icon="line-md:circle"></iconify-icon>
                    </button>
                    <button class="btn btn-sm btn-secondary" id="selectInvertBtn" title="反选">
                        <iconify-icon icon="line-md:switch"></iconify-icon>
                    </button>
                    <span id="selectedCount" class="selected-count">0</span>
                </div>
                <div class="chapter-list" id="chapterList">
                    <div class="empty-state">
                        <div class="empty-state-text">-</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelChaptersBtn">
                    <iconify-icon icon="line-md:close"></iconify-icon>
                </button>
                <button class="btn btn-primary" id="confirmChaptersBtn">
                    <iconify-icon icon="line-md:confirm"></iconify-icon>
                </button>
            </div>
        </div>
    </div>

    <!-- 更新弹窗 -->
    <div class="modal" id="updateModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <iconify-icon icon="line-md:upload-loop"></iconify-icon>
                    <span>更新</span>
                </h3>
                <button class="modal-close" id="updateModalClose">
                    <iconify-icon icon="line-md:close"></iconify-icon>
                </button>
            </div>
            <div class="modal-body">
                <div class="update-info">
                    <p><span id="currentVersion"></span> → <span id="latestVersion"></span></p>
                    <div class="update-description" id="updateDescription"></div>
                    <div id="versionSelector" style="display: none;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeUpdateBtn">
                    <iconify-icon icon="line-md:close"></iconify-icon>
                </button>
                <button class="btn btn-primary" id="downloadUpdateBtn">
                    <iconify-icon icon="line-md:download-loop"></iconify-icon>
                </button>
            </div>
        </div>
    </div>

    <!-- 断点续传确认对话框 -->
    <div class="modal" id="resumeModal" style="display: none;">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>
                    <iconify-icon icon="line-md:backup-restore"></iconify-icon>
                    <span>发现未完成的下载</span>
                </h3>
                <button class="modal-close" id="resumeModalClose">
                    <iconify-icon icon="line-md:close"></iconify-icon>
                </button>
            </div>
            <div class="modal-body">
                <p id="resumeMessage">检测到该书籍有未完成的下载，已下载 <span id="resumeChapterCount">0</span> 个章节。</p>
                <p>是否继续上次的下载？</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="resumeRestartBtn">
                    <iconify-icon icon="line-md:backup-restore"></iconify-icon>
                    <span>重新下载</span>
                </button>
                <button class="btn btn-primary" id="resumeContinueBtn">
                    <iconify-icon icon="line-md:play"></iconify-icon>
                    <span>继续下载</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 队列完成摘要对话框 -->
    <div class="modal" id="queueSummaryModal" style="display: none;">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>
                    <iconify-icon icon="line-md:confirm-circle"></iconify-icon>
                    <span>队列下载完成</span>
                </h3>
                <button class="modal-close" id="queueSummaryModalClose">
                    <iconify-icon icon="line-md:close"></iconify-icon>
                </button>
            </div>
            <div class="modal-body">
                <div class="queue-summary-stats">
                    <div class="stat-item stat-success">
                        <iconify-icon icon="line-md:confirm-circle"></iconify-icon>
                        <span id="summaryCompleted">0</span>
                        <span>成功</span>
                    </div>
                    <div class="stat-item stat-failed">
                        <iconify-icon icon="line-md:close-circle"></iconify-icon>
                        <span id="summaryFailed">0</span>
                        <span>失败</span>
                    </div>
                    <div class="stat-item stat-skipped">
                        <iconify-icon icon="line-md:arrow-right-circle"></iconify-icon>
                        <span id="summarySkipped">0</span>
                        <span>跳过</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="summaryCloseBtn">
                    <iconify-icon icon="line-md:close"></iconify-icon>
                    <span>关闭</span>
                </button>
                <button class="btn btn-primary" id="summaryRetryBtn" style="display: none;">
                    <iconify-icon icon="line-md:backup-restore"></iconify-icon>
                    <span>重试失败</span>
                </button>
            </div>
        </div>
    </div>

    
    <!-- 隐藏的兼容元素 (供JS引用) -->
    <div style="display: none;">
        <div id="bookName"></div>
        <span id="progressPercent">0%</span>
        <div id="progressFill"></div>
        <span id="statusText"></span>
        <div id="logContainer"><div id="logContent"></div></div>
    </div>

    <script src="/static/js/modal.js?v=20260130"></script>
    <script nomodule>
        (function () {
            function showLegacyMessage() {
                var loadingText = document.getElementById('loadingText');
                var loadingHint = document.getElementById('loadingHint');
                if (loadingText) loadingText.textContent = '当前内置浏览器内核过旧，无法启动界面';
                if (loadingHint) loadingHint.textContent = '请安装 Microsoft WebView2 Runtime，或切换到系统浏览器模式';
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', showLegacyMessage, { once: true });
            } else {
                showLegacyMessage();
            }
        })();
    </script>
    <script type="module" src="/static/js/app.js?v=20260130"></script>
</body>
</html>
